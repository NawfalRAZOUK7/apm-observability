# docker/cluster/.env.cluster (managed by Ansible)
# ============================================================================
# Cluster 3 nodes (LAN)
# - DATA node: db + pgbackrest-server
# - CONTROL node: minio + pgbackrest (client)
# - APP node: web + nginx
# ============================================================================

# ----------------------
# Node IPs (LAN)
# ----------------------
DATA_NODE_IP={{ data_node_ip }}
CONTROL_NODE_IP={{ control_node_ip }}
APP_NODE_IP={{ app_node_ip }}

# ----------------------
# Bind IPs (0.0.0.0 = expose sur le LAN du node)
# ----------------------
DATA_BIND_IP={{ data_bind_ip }}
CONTROL_BIND_IP={{ control_bind_ip }}
APP_BIND_IP={{ app_bind_ip }}

# ----------------------
# Credentials / basics
# ----------------------
POSTGRES_DB={{ postgres_db }}
POSTGRES_USER={{ postgres_user }}
POSTGRES_PASSWORD={{ postgres_password }}
POSTGRES_APP_USER={{ postgres_app_user }}
POSTGRES_APP_PASSWORD={{ postgres_app_password }}
POSTGRES_READONLY_USER={{ postgres_readonly_user }}
POSTGRES_READONLY_PASSWORD={{ postgres_readonly_password }}

# ----------------------
# Cluster DB roles (app -> DB routing)
# ----------------------
# Primary is the write target. Replicas are read targets (comma-separated).
# Leave ports out to use POSTGRES_PORT from docker-compose.app.yml.
CLUSTER_DB_PRIMARY_HOST={{ cluster_db_primary_host }}
CLUSTER_DB_REPLICA_HOSTS={{ cluster_db_replica_hosts_list | join(',') }}
# Optional: explicit list for probe scripts
CLUSTER_DB_HOSTS={{ cluster_db_hosts_list | join(',') }}

# Replica host ports (local dev)
CLUSTER_DATA_DB_REPLICA1_HOST_PORT={{ replica1_host_port }}
CLUSTER_DATA_DB_REPLICA2_HOST_PORT={{ replica2_host_port }}

MINIO_ROOT_USER={{ minio_root_user }}
MINIO_ROOT_PASSWORD={{ minio_root_password }}
MINIO_BUCKET={{ minio_bucket }}
MINIO_BUCKET_COLD={{ minio_bucket_cold }}
PGBACKREST_CIPHER_PASS={{ pgbackrest_cipher_pass }}

# Optional
TIMESCALE_IMAGE={{ timescale_image }}
