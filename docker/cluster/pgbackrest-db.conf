# ==========================================================================
# docker/cluster/pgbackrest-db.conf
# pgBackRest config for the DATA node (used by archive_command).
# - Runs locally on the Postgres host, so no pg1-host is set.
# - Repository is MinIO (S3 over HTTPS).
# ==========================================================================

[global]
log-level-console=info
process-max=2

# Repository: MinIO (S3)
repo1-type=s3
repo1-path=/pgbackrest
repo1-s3-endpoint=https://minio:9000
repo1-s3-bucket=pgbackrest
repo1-s3-uri-style=path
repo1-s3-region=us-east-1
repo1-s3-key=apm_backup
repo1-s3-key-secret=apm_backup_secret
repo1-storage-verify-tls=y
repo1-storage-ca-file=/certs/public.crt
repo1-retention-full=2

# Dev-friendly: disable archive checks
archive-check=n
archive-mode-check=n

[apm]
pg1-path=/var/lib/postgresql/data
pg1-port=5432
pg1-user=apm
pg1-database=apm
