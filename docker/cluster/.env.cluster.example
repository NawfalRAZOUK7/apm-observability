# docker/cluster/.env.cluster.example
# ============================================================================
# Cluster 3 nodes (LAN)
# - DATA node: db + pgbackrest-server
# - CONTROL node: minio + pgbackrest (client)
# - APP node: web + nginx
# ============================================================================

# ----------------------
# Node IPs (LAN)
# ----------------------
DATA_NODE_IP=192.168.0.127
CONTROL_NODE_IP=192.168.0.127
APP_NODE_IP=192.168.0.127

# ----------------------
# Bind IPs (0.0.0.0 = expose sur le LAN du node)
# ----------------------
DATA_BIND_IP=0.0.0.0
CONTROL_BIND_IP=0.0.0.0
APP_BIND_IP=0.0.0.0

# ----------------------
# Credentials / basics
# ----------------------
POSTGRES_DB=apm
POSTGRES_USER=apm
POSTGRES_PASSWORD=apm
POSTGRES_APP_USER=apm_writer
POSTGRES_APP_PASSWORD=apm_writer_pass
POSTGRES_READONLY_USER=apm_reader
POSTGRES_READONLY_PASSWORD=apm_reader_pass

# ----------------------
# Cluster DB roles (app -> DB routing)
# ----------------------
# Primary is the write target. Replicas are read targets (comma-separated).
# Leave ports out to use POSTGRES_PORT from docker-compose.app.yml.
CLUSTER_DB_PRIMARY_HOST=192.168.0.127:25432
CLUSTER_DB_REPLICA_HOSTS=192.168.0.128:25433,192.168.0.129:25434
# Optional: explicit list for probe scripts
CLUSTER_DB_HOSTS=192.168.0.127:25432,192.168.0.128:25433,192.168.0.129:25434

# Replica host ports (local dev)
CLUSTER_DATA_DB_REPLICA1_HOST_PORT=25433
CLUSTER_DATA_DB_REPLICA2_HOST_PORT=25434

MINIO_ROOT_USER=apm_backup
MINIO_ROOT_PASSWORD=apm_backup_secret
MINIO_BUCKET=pgbackrest
MINIO_BUCKET_COLD=pgbackrest-cold
PGBACKREST_CIPHER_PASS=CHANGE_ME

# Optional
TIMESCALE_IMAGE=timescale/timescaledb:latest-pg16
