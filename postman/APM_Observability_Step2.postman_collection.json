{
  "info": {
    "_postman_id": "6b8c9c6d-7f3f-4b1c-9e2a-2a1e1b9d0002",
    "name": "APM Observability \u2014 Step 2 (Ingest)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Ingest \u2014 valid (raw list)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/requests/ingest/",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "requests",
            "ingest",
            ""
          ]
        },
        "body": {
          "mode": "raw",
          "raw": "[\n  {\n    \"time\": \"2025-12-14T12:00:00Z\",\n    \"service\": \"billing\",\n    \"endpoint\": \"/api/v1/invoices\",\n    \"method\": \"GET\",\n    \"status_code\": 200,\n    \"latency_ms\": 123,\n    \"trace_id\": \"trace-ok-1\",\n    \"user_ref\": \"user-001\",\n    \"tags\": {\"env\": \"test\"}\n  },\n  {\n    \"time\": \"2025-12-14T12:01:00Z\",\n    \"service\": \"billing\",\n    \"endpoint\": \"/api/v1/invoices\",\n    \"method\": \"GET\",\n    \"status_code\": 201,\n    \"latency_ms\": 10,\n    \"trace_id\": \"trace-ok-2\",\n    \"user_ref\": \"user-002\",\n    \"tags\": {\"env\": \"test\"}\n  }\n]"
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('status is 200', function () {",
              "  pm.response.to.have.status(200);",
              "});",
              "",
              "const json = pm.response.json();",
              "pm.test('inserted is 2', function () {",
              "  pm.expect(json.inserted).to.eql(2);",
              "});",
              "pm.test('rejected is 0', function () {",
              "  pm.expect(json.rejected).to.eql(0);",
              "});"
            ]
          }
        }
      ]
    },
    {
      "name": "Ingest \u2014 mixed invalid (raw list)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/requests/ingest/",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "requests",
            "ingest",
            ""
          ]
        },
        "body": {
          "mode": "raw",
          "raw": "[\n  {\n    \"time\": \"2025-12-14T12:02:00Z\",\n    \"service\": \"orders\",\n    \"endpoint\": \"/api/v1/orders\",\n    \"method\": \"POST\",\n    \"status_code\": 201,\n    \"latency_ms\": 250,\n    \"trace_id\": \"trace-ok-3\",\n    \"user_ref\": \"user-003\",\n    \"tags\": {\"env\": \"test\"}\n  },\n  {\n    \"time\": \"2025-12-14T12:03:00Z\",\n    \"service\": \"orders\",\n    \"endpoint\": \"/api/v1/orders\",\n    \"method\": \"POST\",\n    \"status_code\": 700,\n    \"latency_ms\": 50,\n    \"trace_id\": \"trace-bad-1\",\n    \"user_ref\": \"user-004\",\n    \"tags\": {\"env\": \"test\"}\n  }\n]"
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('status is 200', function () {",
              "  pm.response.to.have.status(200);",
              "});",
              "",
              "const json = pm.response.json();",
              "pm.test('inserted is 1', function () {",
              "  pm.expect(json.inserted).to.eql(1);",
              "});",
              "pm.test('rejected is 1', function () {",
              "  pm.expect(json.rejected).to.eql(1);",
              "});",
              "pm.test('errors contains index 1', function () {",
              "  pm.expect(json.errors).to.be.an('array');",
              "  pm.expect(json.errors.length).to.be.greaterThan(0);",
              "  pm.expect(json.errors[0]).to.have.property('index', 1);",
              "});"
            ]
          }
        }
      ]
    },
    {
      "name": "Ingest \u2014 wrapper {events: [...]}",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/requests/ingest/",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "requests",
            "ingest",
            ""
          ]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"events\": [\n    {\n      \"time\": \"2025-12-14T12:04:00Z\",\n      \"service\": \"auth\",\n      \"endpoint\": \"/api/v1/login\",\n      \"method\": \"POST\",\n      \"status_code\": 200,\n      \"latency_ms\": 80,\n      \"trace_id\": \"trace-w-1\",\n      \"user_ref\": \"user-005\",\n      \"tags\": {\"env\": \"test\"}\n    },\n    {\n      \"time\": \"2025-12-14T12:05:00Z\",\n      \"service\": \"auth\",\n      \"endpoint\": \"/api/v1/logout\",\n      \"method\": \"POST\",\n      \"status_code\": 204,\n      \"latency_ms\": 20,\n      \"trace_id\": \"trace-w-2\",\n      \"user_ref\": \"user-006\",\n      \"tags\": {\"env\": \"test\"}\n    }\n  ]\n}"
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('status is 200', function () {",
              "  pm.response.to.have.status(200);",
              "});",
              "",
              "const json = pm.response.json();",
              "pm.test('inserted is 2', function () {",
              "  pm.expect(json.inserted).to.eql(2);",
              "});",
              "pm.test('rejected is 0', function () {",
              "  pm.expect(json.rejected).to.eql(0);",
              "});"
            ]
          }
        }
      ]
    },
    {
      "name": "Ingest \u2014 strict=true (mixed invalid)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/requests/ingest/?strict=true",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "requests",
            "ingest",
            ""
          ],
          "query": [
            {
              "key": "strict",
              "value": "true"
            }
          ]
        },
        "body": {
          "mode": "raw",
          "raw": "[\n  {\n    \"time\": \"2025-12-14T12:06:00Z\",\n    \"service\": \"orders\",\n    \"endpoint\": \"/api/v1/orders\",\n    \"method\": \"POST\",\n    \"status_code\": 201,\n    \"latency_ms\": 250,\n    \"trace_id\": \"trace-ok-strict\",\n    \"user_ref\": \"user-010\",\n    \"tags\": {\"env\": \"test\"}\n  },\n  {\n    \"time\": \"2025-12-14T12:07:00Z\",\n    \"service\": \"orders\",\n    \"endpoint\": \"/api/v1/orders\",\n    \"method\": \"POST\",\n    \"status_code\": 700,\n    \"latency_ms\": 50,\n    \"trace_id\": \"trace-bad-strict\",\n    \"user_ref\": \"user-011\",\n    \"tags\": {\"env\": \"test\"}\n  }\n]"
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('status is 400', function () {",
              "  pm.response.to.have.status(400);",
              "});",
              "",
              "const json = pm.response.json();",
              "pm.test('inserted is 0', function () {",
              "  pm.expect(json.inserted).to.eql(0);",
              "});",
              "pm.test('rejected > 0', function () {",
              "  pm.expect(json.rejected).to.be.above(0);",
              "});"
            ]
          }
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "base_url",
      "value": "https://{{app_host}}:{{app_https_port}}",
      "type": "string"
    },
    {
      "key": "app_host",
      "value": "127.0.0.1",
      "type": "string"
    },
    {
      "key": "app_https_port",
      "value": "8443",
      "type": "string"
    }
  ]
}
